<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Attorney Commission Calculator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="container topbar__inner">
      <div class="brand">
        <div class="brand__mark">AC</div>
        <div class="brand__text">
          <div class="brand__title">Attorney Commission Calculator</div>
          <div class="brand__subtitle">Azure AI-powered rule selection + math</div>
        </div>
      </div>
      <button id="resetBtn" class="btn btn--ghost" type="button">Reset</button>
    </div>
  </header>

  <main class="container main">
    <section class="card">
      <div class="card__header">
        <h2>Upload Rules + Upload Payment Info â†’ Calculate</h2>
        <p>Upload the rules sheet and the payment information. The app runs AI #1 to calculate the user payment first, then runs AI #2 for the originator only if the originator is different from the user.</p>
      </div>

      <div class="grid">
        <div class="field field--full">
          <label for="rulesFile">Rules sheet file</label>
          <input id="rulesFile" type="file" accept=".txt,.md,.csv,.json,text/plain,text/csv,application/json" />
          <div class="hint">Text-based rules sheet (the rules are treated as authoritative for user payment).</div>
        </div>

        <div class="field field--full">
          <label for="paymentFile">Payment information file</label>
          <input id="paymentFile" type="file" accept=".txt,.md,.csv,.json,text/plain,text/csv,application/json" />
          <div class="hint">
            Provide the payment info in text/CSV/JSON. Include at least <code>amount_usd</code> and <code>user</code>. Optional:
            <code>originator</code>, <code>context</code>, <code>own_origination_percent</code>.
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="runFlowBtn" class="btn btn--primary" type="button">Calculate Payments</button>
        <div id="flowStatus" class="status" aria-live="polite"></div>
      </div>

      <div id="flowResult" class="result" hidden>
        <div class="result__grid">
          <div class="result__item result__item--full">
            <div class="result__label">Parsed payment info</div>
            <div id="parsedInfo" class="result__value result__value--mono"></div>
          </div>
          <div class="result__item">
            <div class="result__label">Rule applied</div>
            <div id="ruleApplied" class="result__value result__value--mono"></div>
          </div>
          <div class="result__item">
            <div class="result__label">Percentage</div>
            <div id="percentage" class="result__value"></div>
          </div>
          <div class="result__item">
            <div class="result__label">User payment</div>
            <div id="userPayment" class="result__value result__value--strong"></div>
          </div>
          <div class="result__item">
            <div class="result__label">Calculation</div>
            <div id="userCalc" class="result__value result__value--mono"></div>
          </div>
          <div class="result__item">
            <div class="result__label">Originator eligibility</div>
            <div id="eligibility" class="pill pill--neutral">Waiting</div>
            <div id="eligibilityNote" class="hint"></div>
          </div>
          <div class="result__item">
            <div class="result__label">Originator payment</div>
            <div id="originatorPayment" class="result__value result__value--strong"></div>
          </div>
          <div class="result__item result__item--full">
            <div class="result__label">Originator calculation</div>
            <div id="originatorCalc" class="result__value result__value--mono"></div>
          </div>
        </div>
      </div>

      <div id="flowCsvResult" class="result" hidden>
        <div class="result__grid">
          <div class="result__item result__item--full">
            <div class="result__label">CSV output</div>
            <textarea id="flowCsv" class="result__value result__value--mono" rows="10" readonly></textarea>
            <div class="actions actions--tight">
              <button id="copyFlowCsvBtn" class="btn btn--ghost" type="button">Copy CSV</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="footer__note">
        The models are instructed to return JSON-only and to treat your uploaded Rules Sheet as authoritative.
      </div>
    </footer>
  </main>

  <script src="script.js"></script>
</body>
</html>
